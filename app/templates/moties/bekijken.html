{% extends 'base.html' %}
{% block content %}
  <style>
    /* Precisie voor print */
    @page { size: A4; margin: 12mm; }
    /* Schermweergave: forceer A4-verhouding en maat */
    .a4 {
      width: 230mm;              /* A4 breedte */
      min-height: 297mm;         /* A4 hoogte */
    }
    /* Voorkom dat lijsten/paragraphs onhandig door pagina's breken */
    .avoid-break { break-inside: avoid; page-break-inside: avoid; }
  </style>
  <div class="sticky top-0 z-10 bg-white/80 backdrop-blur border-b print:hidden">
    <div class="mx-auto max-w-10xl px-4 py-2 flex items-center justify-between">
      <div class="text-sm text-gray-600">Motie {{ motie.titel }}</div>
      <div class="inline-flex rounded-md shadow-xs" role="group">
        <a href="{{ url_for('moties.index') }}" type="button" class="px-4 py-2 text-sm font-medium text-gray-900 bg-white border border-gray-200 rounded-s-lg hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700 dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:hover:text-white dark:hover:bg-gray-700 dark:focus:ring-blue-500 dark:focus:text-white">
          Terug naar overzicht
        </a>
        <a href="{{ url_for('moties.bewerken', motie_id=motie.id) }}" type="button" class="px-4 py-2 text-sm font-medium text-gray-900 bg-white border-t border-b border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700 dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:hover:text-white dark:hover:bg-gray-700 dark:focus:ring-blue-500 dark:focus:text-white">
          <i class="fa fa-edit"></i> Bewerk
        </a>
        <a href="{{ url_for('moties.export_motie_docx', motie_id=motie.id) }}" type="button" class="px-4 py-2 text-sm font-medium text-gray-900 bg-white border-t border-b border-l border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700 dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:hover:text-white dark:hover:bg-gray-700 dark:focus:ring-blue-500 dark:focus:text-white">
          <i class="fa fa-download"></i> Exporteer
        </a>
        <a href="{{ url_for('moties.verwijderen', motie_id=motie.id) }}" type="button" class="px-4 py-2 text-sm font-medium text-white bg-red-500 border border-gray-200 rounded-e-lg hover:bg-red-900 hover:text-white-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700 dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:hover:text-white dark:hover:bg-gray-700 dark:focus:ring-blue-500 dark:focus:text-white">
          <i class="fa fa-trash"></i> Verwijder
        </a>
      </div>
    </div>
  </div>
{% set hoofd = motie.indiener if motie.indiener is defined else None %}
{% set ns = namespace(seen_ids=[], partijen=[]) %}

{# 1) eerst hoofdindiener-partij #}
{% if hoofd and hoofd.partij and hoofd.partij.id not in ns.seen_ids %}
  {% set _ = ns.seen_ids.append(hoofd.partij.id) %}
  {% set _ = ns.partijen.append(hoofd.partij) %}
{% endif %}

{# 2) daarna mede-indieners-partijen #}
{% for x in mede_indieners %}
  {% if x.partij and x.partij.id not in ns.seen_ids %}
    {% set _ = ns.seen_ids.append(x.partij.id) %}
    {% set _ = ns.partijen.append(x.partij) %}
  {% endif %}
{% endfor %}
  <!-- Canvas: centreer A4 op het scherm -->
  <main class="min-h-screen py-8 px-4 flex items-start justify-center print:p-0">
    <article
      class="a4 bg-white shadow-2xl ring-1 ring-black/5 rounded-none print:shadow-none print:ring-0 print:w-auto print:min-h-0
             px-12 py-14 leading-relaxed text-[11pt] text-gray-900">
                   <section class="mb-8 avoid-break">
        <table>
          {% if ns.partijen %}
            {% for row in ns.partijen|batch(6, None) %}
              <tr class="mb-6">
                {% for p in row %}
                  {% if p %}
                    <td class="pr-6 align-top pb-6">
                      <i>
                        <img class="h-24 w-auto" src="{{ p.logo_src }}" alt="{{ p.naam }}">
                      </i>
                    </td>
                  {% else %}
                    <td></td>
                  {% endif %}
                {% endfor %}
              </tr>
            {% endfor %}
          {% else %}
            <tr><td class="text-gray-500">—</td></tr>
          {% endif %}
        </table>
      </section>
      <!-- Kop -->
      <header class="text-center mb-8">
        {% if motie.agendapunt %}
        <h1 class="text-xl font-semibold tracking-tight">MOTIE</h1>
        {% else %}
        <h1 class="text-xl font-semibold tracking-tight">MOTIE vreemd aan de orde van de dag</h1>
        {% endif %}
        <p class="text-sm text-gray-600 mt-1">
          {{ motie.titel or "—" }}
        </p>
      </header>

      <!-- Titel motie -->
      <section class="mb-6 avoid-break">
        {% if motie.agendapunt %}
        <p class="text-[11pt]">Deze motie hoort bij agendapunt {{ motie.agendapunt or "—" }}, ingediend bij de raadsvergadering van {{ motie.gemeenteraad_datum }}</p><br>
        {% endif %}

        <p class="text-[11pt]">De indieners stellen de raad voor om het volgende besluit te nemen:</p>
      </section>

      <!-- Constaterende dat -->
      <section class="mb-6 avoid-break">
        <h2 class="text-base font-semibold mb-1">We stellen vast dat:</h2>
        <ul class="list-disc pl-6 space-y-1">
          {# Als je als JSON-string opslaat: json.loads in de view en hier direct itereren #}
          {% for punt in motie.constaterende_dat %}
            <li>{{ punt }}</li>
          {% else %}
            <li class="text-gray-500">—</li>
          {% endfor %}
        </ul>
      </section>

      <!-- Overwegende dat -->
      <section class="mb-6 avoid-break">
        <h2 class="text-base font-semibold mb-1">We overwegen dat:</h2>
        <ul class="list-disc pl-6 space-y-1">
          {% for punt in motie.overwegende_dat %}
            <li>{{ punt }}</li>
          {% else %}
            <li class="text-gray-500">—</li>
          {% endfor %}
        </ul>
      </section>

      <!-- Draagt het college op -->
      <section class="mb-8 avoid-break">
        <h2 class="text-base font-semibold mb-1">{{ motie.opdracht_formulering }}:</h2>
        <ul class="list-disc pl-6 space-y-1">
          {% for punt in motie.draagt_college_op %}
            <li>{{ punt }}</li>
          {% else %}
            <li class="text-gray-500">—</li>
          {% endfor %}
        </ul>
      </section>


      <!-- Ondertekening -->
            
      <section class="mb-6 avoid-break">
        <p class="text-[11pt]">En gaat over tot de orde van de dag</p>
      </section>
<section class="mb-8 avoid-break">
  <h2 class="text-base font-semibold mb-1">Ingediend door:</h2>

  {# Maak een lijst: eerst hoofdindiener (indien aanwezig), daarna mede-indieners #}
        {% set ondertekenaars = [] %}
        {% if hoofd %}
          {% set _ = ondertekenaars.append(hoofd) %}
        {% endif %}
        {% for x in mede_indieners %}
          {% set _ = ondertekenaars.append(x) %}
        {% endfor %}

        <table>
          {% if ondertekenaars %}
            {% for row in ondertekenaars|batch(6, None) %}
              <tr class="mb-6">
                {% for u in row %}
                  {% if u %}
                    <td class="pr-6 align-top pb-6">
                      {{ u.naam }}<br>
                      <i>{{ u.partij.naam if u.partij else '—' }}</i>
                    </td>
                  {% else %}
                    <td></td>
                  {% endif %}
                {% endfor %}
              </tr>
            {% endfor %}
          {% else %}
            <tr><td class="text-gray-500">—</td></tr>
          {% endif %}
        </table>
      </section>
         <!-- Voet -->
      <footer class="mt-12 pt-4 text-[10pt] text-gray-500 border-t border-gray-200">
        <div class="flex items-center justify-between self-end">
          <span>Raadsvergadering: {{ motie.gemeenteraad_datum or "Niet gepland" }} </span>
          <span>Conceptstatus: {{ motie.status or "Concept" }}</span>
        </div>
      </footer>
    </article>
  </main>
{% endblock %}
